---
layout: page
title: "Django (Python)"
top_title: "部署 Django 应用"
category: tutorial
date: 2015-02-28 20:19
order: 9
published: true
---
### Django 简介
Django 是一个基于 Python 的开源Web应用框架，关于它的详细介绍及安装和使用方法请参考 [Django官网] 。  
Python 开发者可以使用 [pip] 进行安装：
 
{% highlight console %} 
$ pip install Django==1.7.6
{% endhighlight %}

然后用一句命令就可以开始你的 Django 项目：

{% highlight console %} 
$ django-admin startproject djangoApp
{% endhighlight %}

其中“djangoApp”是你的 Django 应用名称，可根据你自己的需要命名。

### 部署方法

#### 1.准备项目
在 CNPaaS 部署 Django 项目极其简单，首先你需要在 CNPaaS 后台[创建]一个 Python 应用：

<img class="embeddable" src="{{site.url}}/images/django/django1.jpg" alt="Django" title="Django" />

然后点击进去应用详情，点击应用的**温馨提示**可以查看快速部署的提示。

首先在终端里用 **git clone** 这个应用的 **Git 地址** 的方法获得初始项目：

{% highlight console %} 
$ git clone <git-url> 
{% endhighlight %}

然后把你的 Django 项目目录里的所有文件复制到这个 git clone 下来的项目目录里。

如果还没有开始开发 Django 项目，你可以在 git clone 之后，进入初始项目的目录，然后：

{% highlight console %} 
$ django-admin startproject djangoApp
{% endhighlight %}

把 djangoApp 重命名：
{% highlight console %} 
$ mv djangoApp djangoAppReName
{% endhighlight %}

把原 djangoAppReName 里的文件都移出来：
 {% highlight console %} 
$ mv djangoAppReName/* .
{% endhighlight %}
并删除这个空的 djangoAppReName ：
{% highlight console %} 
$ rmdir djangoAppReName
{% endhighlight %}

这时候需要修改初始项目的两个文件。

把 **setup.py** 里原来注释 Django 用的“**＃**”去掉*(同时可以修改里边的其他信息)*：
 {% highlight python %} 
install_requires=['Django>=1.3'],
{% endhighlight %}
如图所示：  
<img class="embeddable" src="{{site.url}}/images/django/django2.jpg" alt="Django" title="Django" />

把 **wsgi.py** 里的所有内容改为：
 {% highlight python %} 
#!/usr/bin/python
import os
import sys

os.environ.setdefault("DJANGO_SETTINGS_MODULE", "djangoApp.settings")
PY_DIR = os.path.join(os.environ['OPENSHIFT_REPO_DIR'], "python")

virtenv = PY_DIR + '/virtenv/'
virtualenv = os.path.join(virtenv, 'bin/activate_this.py')

try:
    exec(open(virtualenv).read(), dict(__file__=virtualenv))
except IOError:
    pass

from django.core.wsgi import get_wsgi_application
application = get_wsgi_application()
{% endhighlight %}

 CNPaaS 将会根据 wsgi.py 的设定运行你的 Django 项目。
 
 需要**特别注意**的是：

1. `djangoApp.settings` 里的 **djangoApp** 根据你的实际情况来定，通常是你用 **django-admin** 命令创建项目的那个项目名。
2. 你的 Python 项目需要用到一些 CNPaaS 指定的环境变量，比如：  
	* **`OPENSHIFT_HOMEDIR`** : 整个项目的根目录。
	* **`OPENSHIFT_DATA_DIR`** : 持久数据目录。 
	* **`OPENSHIFT_REPO_DIR`** : 运行应用的主目录。 
	
关于更多的环境变量及详细介绍，请阅读 [OpenShift 的官方文档](https://developers.openshift.com/en/managing-environment-variables.html) 。  
如果是 Python 项目调用环境变量，请使用以下方法：  
 {% highlight python %} 
env_var = os.environ['OPENSHIFT_ENV_VAR']
{% endhighlight %}

#### 2. 推送代码
修改完项目之后，依次执行以下命令：
{% highlight console %} 
$ git add -A .
$ git commit -m "commit信息"
$ git push origin master
{% endhighlight %}
即可把项目部署到 CNPaaS。

对于Git的详细使用，建议参考以下资料：[Pro Git]

#### 3. 访问应用
打开 CNPaaS后台 该应用的详情页面，里面有 **CNPaaS 网址** 一项，点击该网址，即可访问你的应用。

#### 4. 设定独立域名
如果想为你的 Django 应用设定独立的域名进行访问，可参考 [自定义网址]({{site.url}}/usage/custom-domains.html) 。



[Django官网]:https://www.djangoproject.com
[pip]:https://pypi.python.org/pypi/pip
[创建]:http://dashboard.cnpaas.io/a
[Pro Git]:http://git-scm.com/book/zh/