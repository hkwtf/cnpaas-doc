---
layout: page
title: "Flask (Python)"
top_title: "部署 Flask 应用"
category: tutorial
date: 2015-02-28 20:19
order: 10
published: true
---
### Flask 简介
Flask 是一个使用 Python 编写的轻量级 Web 应用框架。也被称为 “microframework” ，因为它使用简单的核心，用 extension 增加其他功能。详细介绍可访问 [Flask官网] ，或者阅读 [Flask中文文档](http://dormousehole.readthedocs.org/en/latest/) 。

### 极速部署
下面我们将以一个 Flask 的“hello world”程序为例子来介绍如何用最快的速度在 CNPaaS 上部署你的 Flask 应用。

首先你需要在 CNPaaS 后台[创建]一个 Python 应用：

<img class="embeddable" src="{{site.url}}/images/flask/flask1.jpg" alt="Flask" title="Flask" />

然后点击进去应用详情，点击应用的**温馨提示**可以查看快速部署的提示。

首先在终端里用 **git clone** 这个应用的 **Git 地址** 的方法获得初始项目：
{% highlight console %} 
$ git clone <git-url>
{% endhighlight %}
进入项目目录，编辑 **requirements.txt** 这个文件，加入这行：
{% highlight console %} 
Flask==0.10.1
{% endhighlight %}

然后把项目文件放到这个目录里，比如 hello.py :
{% highlight python %} 
from flask import Flask
app = Flask(__name__)

@app.route("/")
def hello():
    return "Hello World!"

if __name__ == "__main__":
    app.run()
{% endhighlight %}

最后编辑 **wsgi.py** 文件，把所有内容去掉，替换为：
{% highlight python %} 
#!/usr/bin/python
import os
import sys

PY_DIR = os.path.join(os.environ['OPENSHIFT_REPO_DIR'], "python")

virtenv = PY_DIR + '/virtenv/'
virtualenv = os.path.join(virtenv, 'bin/activate_this.py')

try:
    exec(open(virtualenv).read(), dict(__file__=virtualenv))
except IOError:
    pass

from hello import app as application
{% endhighlight %}
其中 **`os.environ['OPENSHIFT_REPO_DIR']`** 调用了 CNPaaS 关于应用运行目录的环境变量。

另外请注意不同 Python 版本的代码写法差异，比如 Python2.7 的文件头部是这样的：
{% highlight python %} 
#!/usr/bin/python
# -*- coding: utf-8 -*-
{% endhighlight %}

关于更多的环境变量及详细介绍，请阅读 [OpenShift 的官方文档](https://developers.openshift.com/en/managing-environment-variables.html) 。  

接下来依次执行：
{% highlight console %} 
$ git add -A .
$ git commit -m "try clean flask hello world"
$ git push origin master
{% endhighlight %}
这样就把程序文件推送到 CNPaaS 线上运行环境里。  
同时 CNPaaS 会根据 requirements.txt 的设定安装相应的模块。所以你的 Flask 项目依赖什么模块就把 [pip]模块名称 及 版本号 列入到 requirements.txt 里。

你可以通过git返回的信息了解到整个过程是否顺利。完成之后你可以打开 CNPaaS 后台该应用的详情页，点击里面的 **CNPaaS 网址** 进行测试。

<img class="embeddable" src="{{site.url}}/images/flask/flask2.jpg" alt="Flask" title="Flask" />
可以看到“Hello World”，一切都很顺利。

由于 Django 同样为 Python web框架，所以我们推荐你也参考一下 **[如何在 CNPaaS 部署 Django 应用]** ，对某些细节（比如 CNPaaS 环境变量使用方法）有更详细的说明。

[Flask官网]:http://flask.pocoo.org/static/logo/flask.png
[如何在 CNPaaS 部署 Django 应用]:/tutorial/django.html
[pip]:https://pypi.python.org/pypi/pip
[创建]:http://dashboard.cnpaas.io/a 